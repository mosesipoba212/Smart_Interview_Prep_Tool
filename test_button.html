<!DOCTYPE html>
<html>
<head>
    <title>Mock Interview Button Test</title>
</head>
<body>
    <h1>Mock Interview Button Test</h1>
    
    <div>
        <label>Interview Type:</label>
        <select id="interviewType">
            <option value="">Select interview type...</option>
            <option value="technical">Technical Interview</option>
            <option value="behavioral">Behavioral Interview</option>
            <option value="system_design">System Design Interview</option>
            <option value="product">Product Interview</option>
        </select>
    </div>
    
    <div>
        <label>Difficulty:</label>
        <select id="difficulty">
            <option value="">Select difficulty...</option>
        </select>
    </div>
    
    <div>
        <label>Company (Optional):</label>
        <input type="text" id="company" placeholder="e.g., Google, Microsoft, Meta">
    </div>
    
    <div>
        <label>Role (Optional):</label>
        <input type="text" id="role" placeholder="e.g., Software Engineer, Product Manager">
    </div>
    
    <button id="startBtn" onclick="testStartInterview()" disabled>üöÄ Start Interview</button>
    
    <div id="result"></div>
    
    <script>
        const interviewTypes = {
            'technical': {
                'name': 'Technical Interview',
                'difficulty_levels': ['Easy', 'Medium', 'Hard']
            },
            'behavioral': {
                'name': 'Behavioral Interview',
                'difficulty_levels': ['Basic', 'Intermediate', 'Advanced']
            },
            'system_design': {
                'name': 'System Design Interview',
                'difficulty_levels': ['Junior', 'Mid-level', 'Senior']
            },
            'product': {
                'name': 'Product Interview',
                'difficulty_levels': ['Associate', 'Manager', 'Senior']
            }
        };
        
        document.getElementById('interviewType').addEventListener('change', function() {
            const selectedType = this.value;
            const difficultySelect = document.getElementById('difficulty');
            
            difficultySelect.innerHTML = '<option value="">Select difficulty...</option>';
            
            if (selectedType && interviewTypes[selectedType]) {
                const difficulties = interviewTypes[selectedType].difficulty_levels;
                difficulties.forEach(diff => {
                    const option = document.createElement('option');
                    option.value = diff;
                    option.textContent = diff;
                    difficultySelect.appendChild(option);
                });
            }
            
            updateStartButton();
        });
        
        document.getElementById('difficulty').addEventListener('change', updateStartButton);
        
        function updateStartButton() {
            const typeSelected = document.getElementById('interviewType').value;
            const diffSelected = document.getElementById('difficulty').value;
            const shouldEnable = typeSelected && diffSelected;
            console.log('updateStartButton:', { typeSelected, diffSelected, shouldEnable });
            document.getElementById('startBtn').disabled = !shouldEnable;
        }
        
        async function testStartInterview() {
            console.log('testStartInterview() called');
            const startBtn = document.getElementById('startBtn');
            const resultDiv = document.getElementById('result');
            
            startBtn.textContent = 'Starting...';
            startBtn.disabled = true;
            
            const interviewType = document.getElementById('interviewType').value;
            const difficulty = document.getElementById('difficulty').value;
            const company = document.getElementById('company').value;
            const role = document.getElementById('role').value;
            
            console.log('Form values:', { interviewType, difficulty, company, role });
            
            try {
                const response = await fetch('http://localhost:5000/mock-interview/start', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({
                        interview_type: interviewType,
                        difficulty: difficulty,
                        company: company,
                        role: role
                    })
                });
                
                console.log('Response status:', response.status);
                const data = await response.json();
                console.log('Response data:', data);
                
                if (data.success) {
                    resultDiv.innerHTML = '<h2>‚úÖ Interview Started Successfully!</h2>' +
                        '<p>Session ID: ' + data.session.id + '</p>' +
                        '<p>Questions: ' + data.session.questions.length + '</p>' +
                        '<pre>' + JSON.stringify(data.session, null, 2) + '</pre>';
                } else {
                    resultDiv.innerHTML = '<h2>‚ùå Interview Start Failed</h2>' +
                        '<p>Error: ' + data.error + '</p>';
                }
            } catch (error) {
                console.error('Failed to start interview:', error);
                resultDiv.innerHTML = '<h2>‚ùå Network Error</h2>' +
                    '<p>Error: ' + error.message + '</p>';
            }
            
            startBtn.textContent = 'üöÄ Start Interview';
            startBtn.disabled = false;
        }
    </script>
</body>
</html>